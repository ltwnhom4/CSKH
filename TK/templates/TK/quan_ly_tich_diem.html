{% extends "base.html" %}
{% block title %}ƒêi·ªÉm T√≠ch L≈©y Kh√°ch H√†ng{% endblock %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'TK/quanlytichdiem.css' %}">

<div class="container-tichdiem">
 {% if messages %}  <!--N·∫øu c√≥ message t·ª´ Django ‚Üí hi·ªÉn th·ªã l√™n giao di·ªán.-->
 <div class="message-container">
    {% for message in messages %}
    <div class="alert
      {% if message.tags == 'success' %}alert-success{% elif message.tags == 'error' %}alert-error{% endif %}">
        {{ message }}
    </div>
   {% endfor %}
 </div>
 {% endif %}
  <h2>üéØ ƒêi·ªÉm T√≠ch L≈©y Kh√°ch H√†ng</h2>

  <form method="get" style="text-align:center;">  <!--D√πng GET v√¨ ƒë√¢y l√† thao t√°c l·ªçc, kh√¥ng thay ƒë·ªïi d·ªØ li·ªáu.-->
    <input type="text" name="sdt" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i..." value="{{ query }}">
    <button type="submit" class="btn-search">T√¨m ki·∫øm</button>
  </form>

  {% if khach_hang_list %}
  <div class="table-scroll">
    <table>
      <thead>
        <tr>
          <th>H·ªç T√™n</th>
          <th>S·ªë ƒêi·ªán Tho·∫°i</th>
          <th>ƒêi·ªÉm T√≠ch L≈©y</th>
          <th>H·∫°ng</th>
          <th>H√†nh ƒê·ªông</th>
        </tr>
      </thead>
      <tbody>
        {% for kh in khach_hang_list %}
        <tr>
          <td>{{ kh.ho_ten }}</td>
          <td>{{ kh.so_dien_thoai }}</td>
          <td>{{ kh.tich_diem.tong_diem|default:0 }}</td>
          <td><span class="rank-badge
            {% if kh.tich_diem.cap_bac == 'Th√†nh vi√™n m·ªõi üêæ' %}rank-newbie
            {% elif kh.tich_diem.cap_bac == 'B·∫°c' %}rank-silver
            {% elif kh.tich_diem.cap_bac == 'V√†ng üèÜ' %}rank-gold
            {% elif kh.tich_diem.cap_bac == 'Kim c∆∞∆°ng üíé' %}rank-diamond
            {% endif %}">{{ kh.tich_diem.cap_bac }}</span></td>
          <td>
            <form method="post" style="display:flex; justify-content:center; gap:6px;"> <!--Form n√†y d√πng POST ‚Äî v√¨ n√≥ ƒëang THAY ƒê·ªîI d·ªØ li·ªáu trong database-->
              {% csrf_token %}
              <input type="hidden" name="sdt" value="{{ kh.so_dien_thoai }}">  <!--input ·∫©n ƒë·ªÉ x√°c ƒë·ªãnh kh√°ch h√†ng-->
              <input type="number" name="diem_moi" placeholder="Nh·∫≠p s·ªë ƒëi·ªÉm">
              <button type="submit">C·∫≠p nh·∫≠t</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
    <p style="text-align:center; color:#d6336c; font-weight:600; margin-top:25px;">
      Kh√¥ng t√¨m th·∫•y kh√°ch h√†ng n√†o.
    </p>
  {% endif %}
</div>
{% endblock %}
