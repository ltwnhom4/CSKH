{% load static %}

<!-- ğŸŒ¸ CHATBOX Há»– TRá»¢ PUNKY SPA -->
<div class="chatbox" id="chatBox">
  <div class="chat-header">
    <img src="{% static 'trangchu/logo.png' %}" alt="Logo">
    <h4>Punky Spa há»— trá»£ ğŸ¾</h4>
    <span id="closeChat">âœ–</span>
  </div>

  <div class="chat-body" id="chatBody">
    <div class="message bot">
      Xin chÃ o ğŸ‘‹, chÃ o má»«ng báº¡n Ä‘Ã£ Ä‘áº¿n vá»›i <b>Punky Spa</b>!<br>
      Báº¡n cáº§n Ä‘Æ°á»£c há»— trá»£ vá» dá»‹ch vá»¥ nÃ o áº¡?
      <div class="options">
        <button onclick="sendOption('BÃ¡o giÃ¡ dá»‹ch vá»¥')">BÃ¡o giÃ¡ dá»‹ch vá»¥</button>
        <button onclick="sendOption('Há»i Ä‘Ã¡p nhanh (FAQ)')">Há»i Ä‘Ã¡p nhanh</button>
        <button onclick="sendOption('TÆ° váº¥n trá»±c tiáº¿p')">TÆ° váº¥n trá»±c tiáº¿p</button>
      </div>
    </div>
  </div>

  <div class="chat-input-area">
    <input type="text" id="chat-input" placeholder="Nháº­p tin nháº¯n cá»§a báº¡n..." />
    <button id="chat-send"><i class="fa fa-paper-plane"></i></button>
  </div>
</div>

<!-- ğŸŒ¸ CHATBOX SCRIPT -->
<script>
const chatToggle = document.getElementById("chatToggle");
const chatBox = document.getElementById("chatBox");
const closeChat = document.getElementById("closeChat");
const chatBody = document.getElementById("chatBody");
const chatInput = document.getElementById("chat-input");
const chatSend = document.getElementById("chat-send");

if (chatToggle) chatToggle.addEventListener("click", () => chatBox.style.display = "block");
if (closeChat) closeChat.addEventListener("click", () => chatBox.style.display = "none");

if (chatSend) chatSend.addEventListener("click", sendMessage);
if (chatInput) chatInput.addEventListener("keypress", e => { if (e.key === "Enter") sendMessage(); });

function appendMessage(content, sender) {
  const msg = document.createElement("div");
  msg.className = `message ${sender}`;
  msg.innerHTML = content;
  chatBody.appendChild(msg);
  chatBody.scrollTop = chatBody.scrollHeight;
}

function sendMessage() {
  const text = chatInput.value.trim();
  if (!text) return;
  appendMessage(text, "user");
  chatInput.value = "";
  setTimeout(() => appendMessage(getBotReply(text), "bot"), 600);
}

function sendOption(option) {
  appendMessage(option, "user");
  setTimeout(() => appendMessage(autoReply(option), "bot"), 500);
}

function autoReply(option) {
  if (option === "BÃ¡o giÃ¡ dá»‹ch vá»¥") {
    return `
    Báº¡n muá»‘n xem bÃ¡o giÃ¡ cho dá»‹ch vá»¥ nÃ o?
    <div class="options">
      <button onclick="sendOption('Táº¯m rá»­a')">Táº¯m rá»­a</button>
      <button onclick="sendOption('Cáº¯t tá»‰a lÃ´ng')">Cáº¯t tá»‰a lÃ´ng</button>
      <button onclick="sendOption('Nhuá»™m lÃ´ng')">Nhuá»™m lÃ´ng</button>
      <button onclick="sendOption('TÆ° váº¥n sá»©c khá»e')">TÆ° váº¥n sá»©c khá»e</button>
      <button onclick="sendOption('TiÃªm phÃ²ng')">TiÃªm phÃ²ng</button>
      <button onclick="sendOption('Triá»‡t sáº£n')">Triá»‡t sáº£n</button>
    </div>`;
  }

  if (option === "Há»i Ä‘Ã¡p nhanh (FAQ)") {
    return `
      ğŸ’¬ Báº¡n cÃ³ thá»ƒ há»i tÃ´i:<br><br>
      ğŸ¶ â€œPunky Spa cÃ³ nháº­n chÃ³ mÃ¨o ngoÃ i giá» khÃ´ng?â€<br>
      ğŸ’– â€œSau khi táº¯m cÃ³ sáº¥y khÃ´ vÃ  cháº£i lÃ´ng khÃ´ng?â€<br>
      ğŸŒ¸ â€œCÃ³ Ä‘Æ°á»£c mang dáº§u gá»™i riÃªng cho bÃ© khÃ´ng?â€<br><br>
      Hoáº·c báº¡n cÃ³ thá»ƒ chá»n <b>TÆ° váº¥n trá»±c tiáº¿p</b> Ä‘á»ƒ gáº·p nhÃ¢n viÃªn ğŸ’•`;
  }

  if (option === "TÆ° váº¥n trá»±c tiáº¿p") {
    return "ğŸ“ Gá»i ngay <b>1900 6750</b> Ä‘á»ƒ Ä‘Æ°á»£c nhÃ¢n viÃªn Punky Spa há»— trá»£ táº­n tÃ¬nh ğŸ’•";
  }

  return getBotReply(option);
}

function getBotReply(text) {
  text = text.trim().toLowerCase()
      .normalize("NFD").replace(/[\u0300-\u036f]/g, "");

  if (text.includes("tam")) {
    return `ğŸ± <b>Táº¯m rá»­a</b> cÃ³ giÃ¡ khoáº£ng <b>150,000 VND</b>.<br>
    Dá»‹ch vá»¥ táº¯m há»¯u cÆ¡ dá»‹u nháº¹, sáº¥y khÃ´ riÃªng vÃ  massage thÆ° giÃ£n.<br>
    <a href="/dichvu/6/" class="btn">ğŸ‘‰ Xem chi tiáº¿t</a>`;
  }

  if (text.includes("cat") || text.includes("tia long")) {
    return `ğŸ© <b>Cáº¯t tá»‰a lÃ´ng</b> cÃ³ giÃ¡ khoáº£ng <b>200,000 VND</b>.<br>
    Táº¡o kiá»ƒu lÃ´ng dá»… thÆ°Æ¡ng, dá»¥ng cá»¥ chuyÃªn nghiá»‡p.<br>
    <a href="/dichvu/2/" class="btn">ğŸ‘‰ Xem chi tiáº¿t</a>`;
  }

  if (text.includes("nhuom")) {
    return `ğŸ¨ <b>Nhuá»™m lÃ´ng</b> cÃ³ giÃ¡ khoáº£ng <b>300,000 VND</b>.<br>
    MÃ u nhuá»™m an toÃ n, khÃ´ng Ä‘á»™c háº¡i â€“ cho bÃ© thÃªm ná»•i báº­t.<br>
    <a href="/dichvu/4/" class="btn">ğŸ‘‰ Xem chi tiáº¿t</a>`;
  }

  if (text.includes("tu van") || text.includes("suc khoe")) {
    return `ğŸ¶ <b>TÆ° váº¥n sá»©c khá»e</b> cÃ³ giÃ¡ khoáº£ng <b>100,000 VND</b>.<br>
    BÃ¡c sÄ© thÃº y tÆ° váº¥n dinh dÆ°á»¡ng, chÄƒm sÃ³c da lÃ´ng Ä‘á»‹nh ká»³.<br>
    <a href="/dichvu/5/" class="btn">ğŸ‘‰ Xem chi tiáº¿t</a>`;
  }

  if (text.includes("tiem") || text.includes("phong")) {
    return `ğŸ’‰ <b>TiÃªm phÃ²ng</b> cÃ³ giÃ¡ khoáº£ng <b>250,000 VND</b>.<br>
    Vaccine nháº­p kháº©u, theo dÃµi sá»©c khá»e ká»¹ lÆ°á»¡ng sau tiÃªm.<br>
    <a href="/dichvu/3/" class="btn">ğŸ‘‰ Xem chi tiáº¿t</a>`;
  }

  if (text.includes("triet") || text.includes("san")) {
    return `ğŸ•â€ğŸ¦º <b>Triá»‡t sáº£n</b> cÃ³ giÃ¡ khoáº£ng <b>700,000 VND</b>.<br>
    Quy trÃ¬nh an toÃ n, vÃ´ trÃ¹ng, bÃ© há»“i phá»¥c nhanh chÃ³ng.<br>
    <a href="/dichvu/1/" class="btn">ğŸ‘‰ Xem chi tiáº¿t</a>`;
  }

  // FAQ má»Ÿ rá»™ng
  if (text.includes("ngoai gio")) {
    return "â° Spa má»Ÿ cá»­a tá»« <b>09h00 Ä‘áº¿n 21h00</b>. NgoÃ i giá» báº¡n cÃ³ thá»ƒ Ä‘áº·t lá»‹ch trÆ°á»›c ğŸ’•";
  }

  if (text.includes("tai nha")) {
    return "ğŸš— Hiá»‡n Punky Spa <b>chÆ°a há»— trá»£ chÄƒm sÃ³c táº¡i nhÃ </b> ğŸ˜¿, nhÆ°ng báº¡n cÃ³ thá»ƒ Ä‘áº·t lá»‹ch Ä‘á»ƒ Ä‘Æ°á»£c phá»¥c vá»¥ sá»›m nháº¥t ğŸ’•";
  }

  if (text.includes("say") || text.includes("cham soc sau tam")) {
    return "Dáº¡ cÃ³ áº¡ ğŸ’• BÃ© sau khi táº¯m Ä‘Æ°á»£c sáº¥y khÃ´ riÃªng vÃ  cháº£i lÃ´ng nháº¹ nhÃ ng ğŸ¾";
  }

  if (text.includes("dau goi")) {
    return "ğŸŒ¿ Punky Spa cÃ³ <b>dáº§u gá»™i há»¯u cÆ¡</b> cho da nháº¡y cáº£m, vÃ  báº¡n cÃ³ thá»ƒ mang dáº§u riÃªng cho bÃ© ğŸ’š";
  }

  return "ğŸ’— Cáº£m Æ¡n báº¡n Ä‘Ã£ liÃªn há»‡ Punky Spa! Báº¡n cÃ³ thá»ƒ há»i vá» giÃ¡, dá»‹ch vá»¥, hoáº·c chá»n má»¥c 'BÃ¡o giÃ¡ dá»‹ch vá»¥' Ä‘á»ƒ xem chi tiáº¿t nhÃ©. Náº¿u cÃ³ tháº¯c máº¯c khÃ¡c tÃ¬nh yÃªu vui lÃ²ng chá» tÃ­ Ä‘á»ƒ nhÃ¢n viÃªn check tin nháº¯n nhağŸ’•";
}
</script>
